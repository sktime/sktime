name: Auto Assign Issue

on:
  issue_comment:
    types: [created]

permissions:
  issues: write

jobs:
  take-issue:
    runs-on: ubuntu-latest
    if: github.event.issue.pull_request == null

    steps:
      - name: Assign issue to commenter
        uses: actions/github-script@v7
        with:
          script: |
            const issue = context.payload.issue;
            const commenter = context.payload.comment.user.login;
            const commentBody = context.payload.comment.body.trim();

          
            if (commentBody !== ".take") return;

            const labels = issue.labels.map(l => l.name);

        
            if (!labels.includes("good first issue")) {
              await github.rest.issues.createComment({
                ...context.repo,
                issue_number: issue.number,
                body: "This issue is not marked as **good first issue**."
              });
              return;
            }

            
            if (issue.assignees.length > 0) {
              await github.rest.issues.createComment({
                ...context.repo,
                issue_number: issue.number,
                body: "This issue is already assigned."
              });
              return;
            }

           
            await github.rest.issues.addAssignees({
              ...context.repo,
              issue_number: issue.number,
              assignees: [commenter]
            });

            if (!labels.includes("claimed")) {
              await github.rest.issues.addLabels({
                ...context.repo,
                issue_number: issue.number,
                labels: ["claimed"]
              });
            }

            
            await github.rest.issues.createComment({
              ...context.repo,
              issue_number: issue.number,
              body: `Assigned to @${commenter}.\n\n Please open a PR or post an update within **15 days**, otherwise the issue will be unassigned automatically.`
            });

