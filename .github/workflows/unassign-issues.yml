name: Unassign Inactive Good First Issues

on:
  schedule:
    - cron: "0 3 * * *"

permissions:
  issues: write

jobs:
  cleanup:
    runs-on: ubuntu-latest

    steps:
      - name: Unassign inactive good first issues
        uses: actions/github-script@v7
        with:
          script: |
            const now = new Date();
            let page = 1;
            const perPage = 100;

            while (true) {
              const { data: issues } = await github.rest.issues.listForRepo({
                ...context.repo,
                state: "open",
                labels: "good first issue",
                per_page: perPage,
                page
              });

              if (issues.length === 0) break;

              for (const issue of issues) {

              
                if (issue.pull_request) continue;

                
                if (issue.assignees.length === 0) continue;

                const labels = issue.labels.map(l => l.name);

                if (!labels.includes("claimed")) continue;

                const lastUpdated = new Date(issue.updated_at);
                const diffDays = (now - lastUpdated) / (1000 * 60 * 60 * 24);

              
                if (diffDays >= 12 && diffDays < 15) {
                  await github.rest.issues.createComment({
                    ...context.repo,
                    issue_number: issue.number,
                    body: " **Reminder:** This **good first issue** has been inactive for nearly **12 days**.\n\nPlease post an update or open a PR within **3 days**, otherwise it will be unassigned automatically."
                  });
                  continue;
                }

               
                if (diffDays >= 15) {
                  await github.rest.issues.removeAssignees({
                    ...context.repo,
                    issue_number: issue.number,
                    assignees: issue.assignees.map(a => a.login)
                  });

                  
                  await github.rest.issues.removeLabel({
                    ...context.repo,
                    issue_number: issue.number,
                    name: "claimed"
                  });

                  await github.rest.issues.createComment({
                    ...context.repo,
                    issue_number: issue.number,
                    body: " Unassigned due to **15 days of inactivity** on a **good first issue**.\n\nThe issue is now available again for others to claim."
                  });
                }
              }

              page++;
            }

