# -*- coding: utf-8 -*-
"""Catch22 test code."""
import numpy as np
from numpy import testing

from sktime.datasets import load_basic_motions, load_unit_test
from sktime.transformations.panel.catch22 import Catch22


def test_catch22_on_unit_test():
    """Test of Catch22 on unit test data."""
    # load unit test data
    X_train, y_train = load_unit_test(split="train")
    indices = np.random.RandomState(0).choice(len(y_train), 5, replace=False)

    # fit catch22
    c22 = Catch22(outlier_norm=True)
    c22.fit(X_train.iloc[indices], y_train[indices])

    # assert transformed data is the same
    data = np.nan_to_num(c22.transform(X_train.iloc[indices]), False, 0, 0, 0)
    testing.assert_array_almost_equal(data, catch22_unit_test_data)


def test_catch22_single_feature_on_unit_test():
    """Test of Catch22 on unit test data."""
    # load unit test data
    X_train, y_train = load_unit_test(split="train")
    indices = np.random.RandomState(0).choice(len(y_train), 2, replace=False)

    # fit catch22
    c22 = Catch22(outlier_norm=True)
    c22.fit(X_train.iloc[indices], y_train[indices])

    # assert transformed data is the same
    results = catch22_unit_test_data.transpose()
    for i in range(22):
        data = np.nan_to_num(
            c22.transform_single_feature(X_train.iloc[indices], i), False, 0, 0, 0
        )
        testing.assert_array_almost_equal(data, results[i][:2])


def test_catch22_on_basic_motions():
    """Test of Catch22 on basic motions data."""
    # load basic motions data
    X_train, y_train = load_basic_motions(split="train")
    indices = np.random.RandomState(4).choice(len(y_train), 5, replace=False)

    # fit catch22
    c22 = Catch22()
    c22.fit(X_train.iloc[indices], y_train[indices])

    # assert transformed data is the same
    data = np.nan_to_num(c22.transform(X_train.iloc[indices]), False, 0, 0, 0)
    testing.assert_array_almost_equal(data, catch22_basic_motions_data)


catch22_unit_test_data = np.array(
    [
        [
            125.0,
            64.0,
            12.0,
            0.4166666666666666,
            -0.5,
            5.0,
            12.0,
            201809.1796094523,
            0.19634954084936207,
            290.41157230783676,
            10158389.695652174,
            0.6890092384766584,
            6.0,
            1.0,
            4.0,
            1.4836116549664229,
            1.1428571428571428,
            0.33206729175825095,
            0.0,
            0.0,
            0.1111111111111111,
            6.0,
        ],
        [
            162.39999389648438,
            93.69999694824219,
            12.0,
            0.37499999999999994,
            -0.45833333333333337,
            5.0,
            10.0,
            215833.29634416648,
            0.19634954084936207,
            311.8028073602811,
            6178823.478260869,
            0.6040399169957669,
            5.0,
            0.9565217391304348,
            5.0,
            1.601149361627198,
            0.5714285714285714,
            0.33199585882480837,
            0.0,
            0.0,
            0.1111111111111111,
            0.0,
        ],
        [
            132.89999389648438,
            74.94999694824219,
            12.0,
            0.37499999999999994,
            -0.5416666666666667,
            5.0,
            11.0,
            133274.21287765825,
            0.19634954084936207,
            259.5532704990584,
            2922963.4782608696,
            0.8020096485829413,
            5.0,
            1.0,
            5.0,
            1.4836116549664229,
            0.42857142857142855,
            0.33170445599629694,
            0.0,
            0.0,
            0.1111111111111111,
            5.0,
        ],
        [
            215.1999969482422,
            122.0999984741211,
            12.0,
            0.5416666666666666,
            -0.45833333333333337,
            6.0,
            16.0,
            404807.2927517244,
            0.19634954084936207,
            331.0570128841759,
            10323049.43478261,
            0.6251819918197027,
            7.0,
            1.0,
            6.0,
            1.714203171343286,
            0.375,
            0.2487030955256314,
            0.0,
            0.0,
            0.16666666666666666,
            0.0,
        ],
        [
            155.10000610351562,
            82.55000305175781,
            11.0,
            0.37499999999999994,
            -0.5208333333333334,
            5.0,
            12.0,
            276289.15137908916,
            0.19634954084936207,
            317.8343938909621,
            11863211.826086957,
            0.7449158910995153,
            6.0,
            1.0,
            4.0,
            1.4836116549664229,
            1.0,
            0.3320445278536131,
            0.0,
            0.0,
            0.1111111111111111,
            0.0,
        ],
    ]
)
catch22_basic_motions_data = np.array(
    [
        [
            1.2836074829101562,
            0.49142295122146606,
            12.0,
            -0.595,
            -0.4883333333333333,
            3.0,
            6.0,
            2.398561577781358,
            0.5031456984264903,
            1.7078468754875726,
            -0.17433522445008237,
            0.08139438490790991,
            2.0,
            0.8881469115191987,
            8.0,
            1.901868147180096,
            0.75,
            0.08200744884048863,
            0.6595744680851063,
            0.1276595744680851,
            0.0009308889989940398,
            11.0,
        ],
        [
            2.3472940921783447,
            -0.3390697240829468,
            22.0,
            -0.7733333333333333,
            -0.15666666666666662,
            2.0,
            7.0,
            20.22617889017177,
            0.5092816215780329,
            5.713144530833593,
            12.9810874242543,
            0.09700544699742468,
            6.0,
            0.8981636060100167,
            8.0,
            1.955336853414402,
            0.025,
            0.032731703385230154,
            0.5957446808510638,
            0.7872340425531915,
            0.013605442176870748,
            12.0,
        ],
        [
            -0.09692030400037766,
            -0.009259849786758423,
            26.0,
            -0.5133333333333333,
            -0.6858333333333333,
            3.0,
            5.0,
            0.041056491939962456,
            0.5706408530934585,
            0.22088812492458434,
            0.00398598554690871,
            0.06944705742142714,
            2.0,
            0.5893155258764607,
            7.0,
            1.869523066150523,
            0.75,
            0.6017013946518415,
            0.6170212765957447,
            0.7872340425531915,
            0.0110355389396874,
            10.0,
        ],
        [
            0.42760252952575684,
            -1.8662387132644653,
            8.0,
            -0.7416666666666667,
            -0.5266666666666666,
            2.0,
            4.0,
            12.810612264646402,
            0.7485826244881929,
            9.58698290213626,
            -9.650884858956239,
            0.1707873009867936,
            1.0,
            0.8547579298831386,
            7.0,
            1.9909316131550139,
            0.6666666666666666,
            0.055326971137111436,
            0.6382978723404256,
            0.7872340425531915,
            0.005277644503926668,
            7.0,
        ],
        [
            0.018161028623580933,
            -0.48779308795928955,
            11.0,
            -0.5233333333333333,
            -0.4566666666666666,
            3.0,
            7.0,
            1.8922477626968488,
            0.44178646691106466,
            1.3556825635744583,
            0.16535525251855782,
            0.14021435478418484,
            3.0,
            0.8614357262103506,
            8.0,
            1.8781561049178759,
            0.75,
            0.11342130090695095,
            0.6382978723404256,
            0.1276595744680851,
            0.0020719787396964104,
            13.0,
        ],
    ]
)
